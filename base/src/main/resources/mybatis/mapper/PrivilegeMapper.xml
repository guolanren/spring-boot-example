<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.leayun.bdc.dao.PrivilegeMapper">

    <!-- 定义表名 -->
    <sql id="table">
        example_privilege
    </sql>

    <!-- 全字段(按照阿里巴巴java开发手册,包含id、gmt_create、gmt_modified字段) -->
    <sql id="all_columns">
        privilege_id, name, url, gmt_create, gmt_modified
    </sql>

    <!-- 除id外的全字段 -->
    <sql id="all_columns_except_id">
        name, url, gmt_create, gmt_modified
    </sql>

    <!-- 插入操作 -->
    <insert id="insert" useGeneratedKeys="true" keyProperty="privilegeId">
        INSERT INTO <include refid="table"/>
        (<include refid="all_columns_except_id"/>)
        VALUES
        (#{name}, #{url}, #{gmtCreate}, #{gmtModified})
    </insert>

    <!-- 删除操作(根据id) -->
    <delete id="delete">
        DELETE FROM <include refid="table"/>
        WHERE privilege_id = #{privilegeId}
    </delete>

    <!-- 更新操作 -->
    <update id="update">
        UPDATE <include refid="table"/>
        <set>
            <if test="name != null and name != ''">
                name = #{name},
            </if>
            <if test="url != null and url != ''">
                url = #{url}
            </if>
            gmt_modified = #{gmtModified}
        </set>
        WHERE privilege_id = #{privilegeId}
    </update>

    <!-- 查询操作(根据id) -->
    <select id="findById" resultType="Privilege">
        SELECT
        privilege_id,
        name,
        url,
        gmt_create,
        gmt_modified
        FROM <include refid="table"/>
        WHERE privilege_id = #{privilegeId}
    </select>

    <!-- 获取全部操作(对于数据量大于1000的表，必须在分页的条件下调用) -->
    <select id="getAll" resultType="Privilege">
        SELECT
        privilege_id,
        name,
        url,
        gmt_create,
        gmt_modified
        FROM <include refid="table"/>
    </select>

    <!-- 存在操作(根据id) -->
    <select id="exists" resultType="boolean">
        SELECT EXISTS(
        SELECT 1
        FROM <include refid="table"/>
        WHERE privilege_id = #{privilegeId}
        )
    </select>

    <!-- 根据角色id查找相应权限列表 -->
    <select id="findPrivilegesByRoleId" resultType="Privilege">
        SELECT DISTINCT
          p.privilege_id,
          p.name,
          p.url,
          p.gmt_create,
          p.gmt_modified
        FROM example_privilege p
          JOIN example_role_privilege rp ON (p.privilege_id = rp.privilege_id)
        WHERE rp.role_id = #{roleId}
    </select>

</mapper>